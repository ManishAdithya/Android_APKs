## The TruthSpy - Spyware

I initially opened the directory which contained multiple files related to the app. I initially tried to read the AndroidManifest.xml, but wasn't able to open it. I then ran the "file" command on it and found that , it was in binary format. I then used a tool named AXMLPrinter2.java to convert the binary XML to normal XML. 

As the app looked like the apktool decompiled app directory without an apktool.yml file, i created a dummy apktool.yml file in the directory

```
!!brut.androlib.meta.MetaInfo
version: 1.0
apkFileName: compiled.apk  
compressionType: false
doNotCompress:  
  - arsc
  - res/drawable/icon.png
  - assets/*.mp3
usesFramework:
  ids:
    - 1
sdkInfo:
  minSdkVersion: '16'  
  targetSdkVersion: '30' 
packageInfo:
  renameManifestPackage: null
  forcedPackageId: null
versionInfo:
  versionCode: '1'  
  versionName: '1.0' 
sharedLibrary: false
unknownFiles: {}
doNotCompress:  
 - arsc
 - res/raw/some_audio_file.mp3
resourcesAreCompressed: false
keepBrokenResources: false

```

I now tried to compile the apk using the command:

```
apktool b abcabc
```


then went to the "dist" folder to run the apk on genymotion, but then showed the error:
```
adb: failed to install compiled.apk: Failure [INSTALL_PARSE_FAILED_NO_CERTIFICATES: Failed collecting certificates for /data/app/vmdl1329085840.tmp/base.apk: Failed to collect certificates from /data/app/vmdl1329085840.tmp/base.apk: Attempt to get length of null array]
```

Therefore i did the application signing in the follwoing method:

```
apksigner sign --ks ~/.android/debug.keystore --ks-key-alias androiddebugkey --ks-pass pass:android compiled.apk
```

now i tried to install the app, and the app instlaled succesfully, but to my regret the app did not open, there were critical issues with the app code, which i was too lazy to fix. So i jumped right to the app code.


Then opened the folder using JADX, so that i see the decompiled code of classes.dex file. I then opened the AndroidManifest.xml to search for "MAIN" , so that i find out which activity is the Launcher Activity, and saw that the UIPolicyActivity is the Launcher Activity.

## Understanding the UIPolicyActivity:

In the UIPolicyActivity , we see a SharedPreferences code, which is used to read and write settings from **app_prefs_settings**.

If no data  is found , it sets str = "0", otherwise it sets the str = "1". 

The activity checks if the user has accepted the "Terms Of Service".

The AsyncTask checks if a specific brand is registered in the background, updating shared preferences with brand information.

Depending on the result of this check, the app logs and processes the data accordingly.

**IN THE SHARED PREFS WE GET A URL :**
```
<string name="default_data_server">protocol-a943.thetruthspy.com/protocols</string> 
```

q is set to "https://thetruthspy.com/terms-of-use/"
r is set to "https://thetruthspy.com/refund-policy/"

When i open these links, it shows "0" , which might indicate that as i am not gsending data to this website, it shows the json output as "0" (according to the code)

The UIPolicyActivity ,changes to UISettingsActivity and UIPlayProtectActivity based on the values of "i" and "z", which arent clearly explained in the app, let's understand the UISettingsActivity to know what is happening in it. 


## Understanding the UISettingsActivity

This is a very important activity, it initially checks if the dvice is rooted or not. 

The activity verifies whether an accessibility service is enabled by checking the enabled_accessibility_services setting.

This verification is used to update the UI or notify the user to enable the service if it's not active.

Logs and returns a boolean indicating whether the service is active.

The code manages various permissions, including location, SMS, phone state, storage, and others.

It maintains a list of permissions and requests them if needed.

As the UISettingsActivity is looking for Accessibility Permissions, let's look into the AccessibilityPermissions Activity


## Understnding the UIAccessibilityService

This is the main malicious activity that happens in the app, as the app now has the acessibility permissions, the app logs the following

1. UUID or IMEI of each device (uniquely identify each device)
2. Button clicks, navigation events, and interactions within the app.
3. API endpoints accessed, request payloads, and response status.
4. User session start/end, token validations, and expirations.
5. Device model, OS version, manufacturer, and screen resolution.
7. Wi-Fi or cellular network type, signal strength, and connectivity status.
8. Authentication details
9. File read/write operations and paths accessed.
10. Logs about battery consumption, CPU usage, or memory.
11. Push notifications received or actions performed on them.
12. Cryptographic operations or security checks.








